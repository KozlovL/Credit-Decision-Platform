# Credit Decision Platform (–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π)

## –ê–≤—Ç–æ—Ä

**–ö–æ–∑–ª–æ–≤ –õ–µ–æ–Ω–∏–¥** [GitHub](https://github.com/KozlovL)

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

* **user-data-service** ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
* **flow-selection-service** ‚Äî —Å–µ—Ä–≤–∏—Å –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —Ñ–ª–æ—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (PIONEER / REPEATER).
* **scoring-service** ‚Äî —Å–µ—Ä–≤–∏—Å —Å–∫–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–¥–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.
* **antifraud-service** ‚Äî —Å–µ—Ä–≤–∏—Å –∞–Ω—Ç–∏—Ñ—Ä–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π PIONEER –∏ REPEATER.
* **common** ‚Äî –æ–±—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏, —Å—Ö–µ–º–∞–º–∏ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö.

–°–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ REST API, –∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–±—ã—Ç–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Kafka.
–î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–∞–∫–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î —Å –ø–æ–º–æ—â—å—é Redis.

---

## Docker –∏ Kafka UI

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Docker:

* **Kafka UI** –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8085` –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

* –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ Docker:

  * Kafka: `kafka:29092`
  * Zookeeper: `zookeeper:2181`
  * Kafka UI: `kafka-ui:8085`

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

* Docker –∏ Docker Compose
* Python 3.12
* Poetry

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

```bash
git clone -b shift-3949 git@shift.gitlab.yandexcloud.net:shift-python/y2025/homeworks/kozlov-l/shift_project.git
cd shift_project
```

### 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
cp .env.example .env
```

> –¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `.env`.

### 3. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose up -d
```

> –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –≤ —Ñ–æ–Ω–µ, –≤–∫–ª—é—á–∞—è Kafka –∏ Kafka UI.

### 4. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

#### user-data-service

* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://127.0.0.1:8001/docs`

#### flow-selection-service

* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://127.0.0.1:8000/docs`

#### scoring-service

* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://127.0.0.1:8002/docs`

#### antifraud-service

* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://127.0.0.1:8003/docs`

---

## –ü—Ä–∏–º–µ—Ä—ã JSON payload

### user-data-service ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```json
{
  "phone": "72222222222",
  "profile": {
    "age": 25,
    "monthly_income": 3000000,
    "employment_type": "full_time",
    "has_property": false
  },
  "loan_entry": {
    "loan_id": "loan_72222222222_20251103123000",
    "product_name": "ConsumerLoan",
    "amount": 1000000,
    "issue_date": "2025-11-03",
    "term_days": 90,
    "status": "open",
    "close_date": null
  }
}
```

### flow-selection-service ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–ª–æ—É

```json
{
  "phone": "72222222222"
}
```

### scoring-service ‚Äî —Å–∫–æ—Ä–∏–Ω–≥ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (PIONEER)

```json
{
  "user_data": {
    "phone": "72222222221",
    "age": 25,
    "monthly_income": 3000000,
    "employment_type": "full_time",
    "has_property": false
  },
  "products": [
    {"name": "MicroLoan", "max_amount": 3000000, "term_days": 30, "interest_rate_daily": 2.0}
  ]
}
```

### antifraud-service ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∏ PIONEER –∏ REPEATER

#### POST /api/antifraud/pioneer/check

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**:

```json
{
  "user_data": {
    "phone": "72222222221",
    "age": 28,
    "monthly_income": 4500000,
    "employment_type": "full_time",
    "has_property": true
  }
}
```

#### POST /api/antifraud/repeater/check

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**:

```json
{
  "phone": "72222222222",
  "current_profile": {
    "age": 35,
    "monthly_income": 6000000,
    "employment_type": "full_time",
    "has_property": true
  }
}
```

> –í—Å–µ –æ—à–∏–±–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Data Service –∏–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `502 Bad Gateway`.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Grafana + Prometheus + Jaeger)

–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

### üìä Grafana

–ê–¥—Ä–µ—Å Grafana: `http://158.160.193.181:30030/`

### üîé Jaeger

–ê–¥—Ä–µ—Å Jaeger: `http://158.160.193.181:30040/search`

> –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç—Ä–µ–π—Å–∏–Ω–≥-—Å–µ—Å—Å–∏–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –≤–∫–ª—é—á–∞—è antifraud-service.

---

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
docker compose exec {service-name} poetry run pytest -v
```

> –í –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã –∫ Data Service –∏ Antifraud Service –∑–∞–º–æ–∫–∞–Ω—ã.

---

## –î–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ Helm

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh -L 8081:localhost:8081 -L 8082:localhost:8082 -L 8080:localhost:8080 <user>@host-vm
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∞—Ä—Ç–æ–≤ Helm

```bash
helm install lkozlov-user-data-service user-data-service/charts -n test
helm install lkozlov-flow-selection-service flow-selection-service/charts -n test
helm install lkozlov-scoring-service scoring-service/charts -n test
```

### 3. –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
kubectl port-forward svc/user-data-service-lkozlov 8081:8001 &
kubectl port-forward svc/flow-selection-service-lkozlov 8080:8000 &
kubectl port-forward svc/scoring-service-lkozlov 8082:8002 &
```

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –í—Å–µ —Å—É–º–º—ã —É–∫–∞–∑–∞–Ω—ã –≤ –∫–æ–ø–µ–π–∫–∞—Ö.
* –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Kafka.
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç—Ä–µ–π—Å–∏–Ω–≥ –≤–∫–ª—é—á–µ–Ω—ã –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö.
